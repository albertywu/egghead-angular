// Generated by CoffeeScript 1.7.1
(function() {
  var app, viewCtrl;

  app = angular.module('myApp', ['ngRoute']);

  app.config(function($routeProvider) {
    return $routeProvider.when('/', {
      templateUrl: 'homepage.html',
      controller: 'ViewCtrl',
      resolve: {
        loadData: viewCtrl.loadData
      }
    }).when('/map/:country/:state/:city', {
      templateUrl: 'app.html',
      controller: 'AppCtrl',
      redirectTo: function(routeParams, path, search) {
        console.log(routeParams);
        console.log(path);
        console.log(search);
        if (routeParams.country !== 'USA') {
          return "/map/USA/" + routeParams.state + "/" + routeParams.city;
        }
      }
    }).otherwise({
      redirectTo: '/'
    });
  });

  app.controller('AppCtrl', function($rootScope) {
    $rootScope.$on('$routeChangeError', function(event, current, previous, rejection) {
      return console.log(rejection);
    });
    return $rootScope.$on('$routeChangeSuccess', function(event, current, previous) {
      return console.log(event);
    });
  });

  viewCtrl = app.controller('ViewCtrl', function($scope, $routeParams, $route) {
    return $scope.model = {
      message: "You found " + $routeParams.country + " > " + $routeParams.state + " > " + $routeParams.city
    };
  });

  viewCtrl.loadData = function($q, $timeout) {
    var deferred;
    deferred = $q.defer();
    $timeout(function() {
      return deferred.reject('your internet is down');
    }, 1000);
    return deferred.promise;
  };

}).call(this);
